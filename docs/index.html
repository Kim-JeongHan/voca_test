<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Vocabulary training app - Learn words with immediate retry and progressive hints">
    <title>Voca Trainer</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="login-screen" class="screen">
            <header>
                <h1>Login</h1>
            </header>
            <main class="auth-main">
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" required autocomplete="current-password">
                    </div>
                    <div id="login-error" class="error-message hidden"></div>
                    <button type="submit" class="btn btn-primary btn-full">Login</button>
                </form>
                <div class="auth-links">
                    <button id="show-register-btn" class="btn-link">Create Account</button>
                    <button id="show-reset-btn" class="btn-link">Forgot Password?</button>
                    <button id="skip-login-btn" class="btn-link">Continue without login</button>
                </div>
            </main>
        </div>

        <!-- Register Screen -->
        <div id="register-screen" class="screen">
            <header>
                <button id="register-back-btn" class="btn-icon">&larr;</button>
                <h1>Create Account</h1>
            </header>
            <main class="auth-main">
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" required minlength="3" maxlength="50" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email (optional)</label>
                        <input type="email" id="register-email" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" required minlength="6" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label for="register-confirm">Confirm Password</label>
                        <input type="password" id="register-confirm" required minlength="6" autocomplete="new-password">
                    </div>
                    <div id="register-error" class="error-message hidden"></div>
                    <button type="submit" class="btn btn-primary btn-full">Create Account</button>
                </form>
            </main>
        </div>

        <!-- Password Reset Screen -->
        <div id="reset-screen" class="screen">
            <header>
                <button id="reset-back-btn" class="btn-icon">&larr;</button>
                <h1>Reset Password</h1>
            </header>
            <main class="auth-main">
                <form id="reset-form" class="auth-form">
                    <p class="form-help">Enter your email address and we'll send you a reset link.</p>
                    <div class="form-group">
                        <label for="reset-email">Email</label>
                        <input type="email" id="reset-email" required autocomplete="email">
                    </div>
                    <div id="reset-error" class="error-message hidden"></div>
                    <div id="reset-success" class="success-message hidden"></div>
                    <button type="submit" class="btn btn-primary btn-full">Send Reset Link</button>
                </form>
            </main>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="screen">
            <header>
                <h1>Voca Trainer</h1>
                <div id="user-area">
                    <span id="user-name" class="hidden"></span>
                    <button id="logout-btn" class="btn btn-secondary btn-small hidden">Logout</button>
                    <button id="login-btn" class="btn btn-primary btn-small">Login</button>
                </div>
            </header>
            <main>
                <div class="deck-section">
                    <h2>Deck</h2>
                    <div id="deck-info" class="deck-info">
                        <span id="deck-name">No deck loaded</span>
                        <span id="deck-count">0 words</span>
                    </div>
                    <div class="deck-actions">
                        <select id="deck-select" class="deck-select">
                            <option value="">-- Select Deck --</option>
                        </select>
                        <button id="import-btn" class="btn btn-secondary">Import CSV</button>
                        <input type="file" id="file-input" accept=".csv" hidden>
                    </div>
                </div>

                <div class="session-section">
                    <h2>Start Session</h2>
                    <div class="preset-buttons">
                        <button id="start-all-btn" class="btn btn-primary" disabled>All Words</button>
                        <button id="start-short-btn" class="btn btn-primary" disabled>Short (20)</button>
                        <button id="start-wrong-btn" class="btn btn-primary" disabled>Wrong Only</button>
                    </div>
                </div>

                <div class="options-section">
                    <label class="toggle-label">
                        <input type="checkbox" id="focus-mode-toggle">
                        <span>Focus Mode</span>
                    </label>
                </div>

                <div class="options-section tts-section">
                    <h3>Audio (TTS)</h3>
                    <label class="toggle-label">
                        <input type="checkbox" id="tts-toggle" checked>
                        <span>Enable TTS</span>
                    </label>
                    <label class="toggle-label">
                        <input type="checkbox" id="tts-autoplay-toggle" checked>
                        <span>Auto-play on new word</span>
                    </label>
                    <button id="clear-audio-cache-btn" class="btn btn-secondary btn-small">Clear Audio Cache</button>
                </div>
            </main>
        </div>

        <!-- Session Screen -->
        <div id="session-screen" class="screen">
            <header>
                <button id="back-btn" class="btn-icon">&larr;</button>
                <div id="progress-display">
                    <span id="progress-text">0/0</span>
                    <div id="progress-bar"><div id="progress-fill"></div></div>
                </div>
            </header>
            <main>
                <div id="question-area">
                    <div id="question-row">
                        <div id="question-text"></div>
                        <button id="speaker-btn" class="btn-icon" title="Play pronunciation">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                            </svg>
                        </button>
                        <button id="image-btn" class="btn-icon" title="Show association image">üñºÔ∏è</button>
                    </div>
                    <div id="hint-text"></div>
                    <img id="association-image" class="hidden" alt="Association image">
                </div>
                <div id="answer-area">
                    <input type="text" id="answer-input" placeholder="Type your answer..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                    <div id="action-buttons">
                        <button id="hint-btn" class="btn btn-secondary">Hint</button>
                        <button id="submit-btn" class="btn btn-primary">Submit</button>
                    </div>
                    <div id="feedback-area" class="hidden">
                        <div id="feedback-icon"></div>
                        <div id="feedback-text"></div>
                    </div>
                </div>
            </main>
            <footer>
                <div id="attempt-info">Attempt: 1 | Hints: 0</div>
                <button id="quit-btn" class="btn btn-secondary btn-small">Save & Quit</button>
            </footer>
        </div>

        <!-- Summary Screen -->
        <div id="summary-screen" class="screen">
            <header>
                <h1>Session Complete</h1>
            </header>
            <main>
                <div id="score-display">
                    <div id="score-circle">
                        <span id="score-value">0</span>
                        <span id="score-total">/0</span>
                    </div>
                </div>
                <div id="wrong-count-display">
                    <span id="wrong-count">0</span> words needed retry
                </div>
                <div class="summary-actions">
                    <button id="export-wrong-btn" class="btn btn-secondary">Export Wrong</button>
                    <button id="retry-wrong-btn" class="btn btn-primary" disabled>Retry Wrong</button>
                    <button id="home-btn" class="btn btn-primary">Home</button>
                </div>
            </main>
        </div>
    </div>

    <script src="wasm/voca_core.js" onerror="console.warn('WASM not available, will use JS fallback')"></script>
    <script src="js/storage.js"></script>
    <script src="js/tts.js"></script>
    <script src="js/image_association.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Register service worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service worker registered'))
                    .catch(err => console.log('Service worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
